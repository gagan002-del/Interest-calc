<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, maximum-scale=1.0">
    <title>Professional Interest Calculator</title>
    
    <!-- PDF Generation Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.23/jspdf.plugin.autotable.js"></script>

    <style>
        * {
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            margin: 0;
            padding: 15px;
            background-color: #f4f7fc;
            color: #333;
            font-size: 16px;
            line-height: 1.5;
            -webkit-text-size-adjust: 100%;
        }
        
        .container {
            max-width: 100%;
            margin: auto;
            background-color: #ffffff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
        }
        
        h1 {
            text-align: center;
            color: #2c3e50;
            margin-bottom: 25px;
            font-size: 24px;
        }
        
        .form-section {
            background-color: #f8f9fa;
            padding: 20px;
            border-radius: 6px;
            border: 1px solid #e9ecef;
            margin-bottom: 25px;
        }
        
        .form-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 15px;
            align-items: flex-end;
        }
        
        @media (min-width: 480px) {
            .form-grid {
                grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            }
        }
        
        .form-grid > div { 
            display: flex; 
            flex-direction: column; 
        }
        
        label { 
            margin-bottom: 8px; 
            font-size: 14px; 
            font-weight: 500; 
            color: #495057; 
        }
        
        input, select { 
            padding: 14px; 
            border: 2px solid #ced4da; 
            border-radius: 8px; 
            font-size: 16px; 
            background-color: white;
            min-height: 48px;
            -webkit-appearance: none;
            appearance: none;
        }
        
        input:focus, select:focus {
            outline: none;
            border-color: #007bff;
            box-shadow: 0 0 0 2px rgba(0, 123, 255, 0.25);
        }
        
        .checkbox-container {
            padding-top: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .checkbox-container input[type="checkbox"] {
            min-height: 20px;
            width: 20px;
            margin: 0;
        }
        
        .checkbox-container label {
            font-size: 13px;
            font-weight: normal;
            margin: 0;
            cursor: pointer;
            flex: 1;
        }
        
        .actions {
            margin-top: 20px;
            display: grid;
            grid-template-columns: 1fr;
            gap: 12px;
        }
        
        @media (min-width: 480px) {
            .actions {
                grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            }
        }
        
        button, .button-label {
            padding: 16px 20px;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            transition: all 0.2s;
            text-align: center;
            min-height: 52px;
            display: flex;
            align-items: center;
            justify-content: center;
            text-decoration: none;
            user-select: none;
            -webkit-user-select: none;
        }
        
        button:active, .button-label:active {
            transform: scale(0.98);
        }
        
        .add-btn { 
            background-color: #28a745; 
            background-image: linear-gradient(to bottom, #28a745, #20923a);
        }
        .add-btn:hover, .add-btn:active { 
            background-color: #218838; 
        }
        
        .export-btn { 
            background-color: #ffc107; 
            color: #212529;
            background-image: linear-gradient(to bottom, #ffc107, #e0a800);
        }
        .export-btn:hover, .export-btn:active { 
            background-color: #e0a800; 
        }

        .import-btn { 
            background-color: #17a2b8; 
            background-image: linear-gradient(to bottom, #17a2b8, #138496);
        }
        .import-btn:hover, .import-btn:active { 
            background-color: #138496; 
        }
        
        .pdf-btn { 
            background-color: #007bff; 
            background-image: linear-gradient(to bottom, #007bff, #0069d9);
        }
        .pdf-btn:hover, .pdf-btn:active { 
            background-color: #0069d9; 
        }

        .clear-btn { 
            background-color: #dc3545; 
            background-image: linear-gradient(to bottom, #dc3545, #c82333);
        }
        .clear-btn:hover, .clear-btn:active { 
            background-color: #c82333; 
        }

        .table-container {
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
            margin-top: 25px;
            border-radius: 8px;
            border: 1px solid #dee2e6;
        }
        
        table { 
            width: 100%; 
            border-collapse: collapse; 
            min-width: 700px;
            background-color: white;
        }
        
        th, td { 
            border: 1px solid #dee2e6; 
            padding: 12px 8px; 
            text-align: right; 
            font-size: 14px;
        }
        
        th { 
            background-color: #e9ecef; 
            font-weight: 600; 
            text-align: center; 
            position: sticky;
            top: 0;
            z-index: 10;
        }
        
        tbody tr:nth-child(even) { 
            background-color: #f8f9fa; 
        }
        
        tbody tr:not(.edit-mode) { 
            cursor: pointer;
            transition: background-color 0.2s;
        }
        
        tbody tr:not(.edit-mode):hover { 
            background-color: #e3f2fd; 
        }

        tfoot { 
            display: table-footer-group; 
        }
        
        tfoot td { 
            font-weight: bold; 
            background-color: #e9ecef; 
            border-top: 2px solid #adb5bd;
        }
        
        .text-left { 
            text-align: left; 
        }
        
        .action-btn { 
            background: none; 
            border: none; 
            cursor: pointer; 
            font-size: 20px; 
            padding: 8px; 
            min-height: 36px;
            min-width: 36px;
            border-radius: 4px;
            transition: all 0.2s;
        }
        
        .action-btn:active {
            transform: scale(0.9);
        }
        
        .save-btn { 
            color: #28a745; 
            background-color: rgba(40, 167, 69, 0.1);
        }
        
        .cancel-btn { 
            color: #6c757d; 
            background-color: rgba(108, 117, 125, 0.1);
        }
        
        .delete-btn { 
            color: #dc3545; 
            background-color: rgba(220, 53, 69, 0.1);
        }
        
        .edit-mode input, .edit-mode select {
            width: 100%;
            padding: 6px;
            font-size: 13px;
            min-height: 32px;
            border: 1px solid #ced4da;
            border-radius: 4px;
        }
        
        .edit-mode .combined-field {
            display: flex;
            gap: 4px;
            align-items: center;
        }
        
        .edit-mode .combined-field select {
            width: 70px;
            flex-shrink: 0;
        }
        
        .edit-mode .combined-field input {
            flex: 1;
            min-width: 80px;
        }
        
        .status-message {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background-color: #28a745;
            color: white;
            padding: 12px 24px;
            border-radius: 8px;
            font-weight: 500;
            z-index: 1000;
            opacity: 0;
            transition: opacity 0.3s;
        }
        
        .status-message.show {
            opacity: 1;
        }
        
        .status-message.error {
            background-color: #dc3545;
        }
        
        /* Loading state */
        .loading {
            opacity: 0.6;
            pointer-events: none;
        }
        
        @media (max-width: 767px) {
            body {
                padding: 10px;
            }
            
            .container {
                padding: 15px;
            }
            
            h1 {
                font-size: 20px;
                margin-bottom: 20px;
            }
            
            .form-section {
                padding: 15px;
            }
            
            th, td {
                padding: 8px 4px;
                font-size: 13px;
            }
            
            button, .button-label {
                padding: 14px 16px;
                font-size: 15px;
                min-height: 48px;
            }
        }
    </style>
</head>
<body>

<div class="status-message" id="statusMessage"></div>

<div class="container">
    <h1>üìä Professional Interest Calculator</h1>

    <div class="form-section">
        <div class="form-grid">
            <div>
                <label for="amount">üí∞ Amount</label>
                <input type="number" id="amount" placeholder="Enter amount" step="0.01" min="0">
            </div>
            <div>
                <label for="from-date">üìÖ From Date</label>
                <input type="date" id="from-date">
            </div>
            <div>
                <label for="to-date">üìÖ To Date</label>
                <input type="date" id="to-date">
                <div class="checkbox-container">
                    <input type="checkbox" id="default-to-date">
                    <label for="default-to-date">Set 'To Date' as default</label>
                </div>
            </div>
            <div>
                <label for="txn-type">üîÑ Transaction Type</label>
                <select id="txn-type">
                    <option value="debit">üìà Debit (Amount Owed)</option>
                    <option value="credit">üìâ Credit (Payment Made)</option>
                </select>
            </div>
            <div>
                <label for="daily-rate">üìä Daily Rate (%)</label>
                <input type="number" id="daily-rate" step="0.001" value="0.05" min="0" max="100">
            </div>
        </div>
        <div class="actions">
            <button class="add-btn" onclick="addEntry()">‚ûï Add Entry</button>
            <button class="export-btn" onclick="exportData()">üì§ Export Data</button>
            <label for="import-file" class="button-label import-btn">üì• Import Data</label>
            <input type="file" id="import-file" accept=".json" style="display: none;" onchange="importData(event)">
            <button class="pdf-btn" onclick="downloadPDF()">üìÑ Download PDF</button>
            <button class="clear-btn" onclick="clearAllData()">üóëÔ∏è Clear All</button>
        </div>
    </div>
    
    <div class="table-container">
        <table>
            <thead>
                <tr>
                    <th class="text-left">From Date</th>
                    <th class="text-left">To Date</th>
                    <th>Debit Amount</th>
                    <th>Credit Amount</th>
                    <th>Days</th>
                    <th>Rate %</th>
                    <th>Interest</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody id="result-body"></tbody>
            <tfoot>
                <tr>
                    <td colspan="2" class="text-left"><strong>üìä Totals</strong></td>
                    <td id="total-debit">0.00</td>
                    <td id="total-credit">0.00</td>
                    <td></td>
                    <td><strong>Net Interest</strong></td>
                    <td id="total-interest">0.00</td>
                    <td></td>
                </tr>
                <tr>
                    <td colspan="5" class="text-left"></td>
                    <td><strong>üí∞ Grand Balance</strong></td>
                    <td id="grand-balance">0.00</td>
                    <td></td>
                </tr>
            </tfoot>
        </table>
    </div>
</div>

<script>
    // Global variables
    let transactions = JSON.parse(localStorage.getItem('interestCalculatorDataV2')) || [];
    let editingRowId = null;
    let reportTotals = { totalDebit: 0, totalCredit: 0, totalInterest: 0, grandBalance: 0 };

    // Utility functions
    function showStatusMessage(message, isError = false) {
        const statusEl = document.getElementById('statusMessage');
        statusEl.textContent = message;
        statusEl.className = `status-message show ${isError ? 'error' : ''}`;
        
        setTimeout(() => {
            statusEl.className = 'status-message';
        }, 3000);
    }

    function setLoading(isLoading) {
        document.body.classList.toggle('loading', isLoading);
    }

    function validateInputs(amount, fromDateStr, toDateStr, dailyRate) {
        if (isNaN(amount) || amount <= 0) {
            throw new Error("Please enter a valid positive amount.");
        }
        if (!fromDateStr || !toDateStr) {
            throw new Error("Please select both from and to dates.");
        }
        if (new Date(toDateStr) < new Date(fromDateStr)) {
            throw new Error("'To Date' cannot be earlier than 'From Date'.");
        }
        if (isNaN(dailyRate) || dailyRate < 0 || dailyRate > 100) {
            throw new Error("Please enter a valid daily rate between 0 and 100.");
        }
    }

    function renderAndSave() {
        if(editingRowId) {
            editingRowId = null;
        }
        renderTable();
        saveData();
    }

    function saveData() {
        try {
            localStorage.setItem('interestCalculatorDataV2', JSON.stringify(transactions));
        } catch (e) {
            showStatusMessage("Warning: Could not save data. Storage may be full.", true);
        }
    }

    function addEntry() {
        try {
            const amount = parseFloat(document.getElementById('amount').value);
            const fromDateStr = document.getElementById('from-date').value;
            const toDateStr = document.getElementById('to-date').value;
            const type = document.getElementById('txn-type').value;
            const dailyRate = parseFloat(document.getElementById('daily-rate').value);

            validateInputs(amount, fromDateStr, toDateStr, dailyRate);

            const newEntry = {
                id: Date.now(),
                amount, fromDateStr, toDateStr, type, dailyRate
            };
            
            transactions.push(newEntry);
            renderAndSave();
            clearInputs();
            showStatusMessage("‚úÖ Entry added successfully!");
        } catch (error) {
            showStatusMessage(error.message, true);
        }
    }
    
    function renderTable() {
        transactions.sort((a, b) => new Date(a.fromDateStr) - new Date(b.fromDateStr));

        const tableBody = document.getElementById('result-body');
        tableBody.innerHTML = '';

        let totalDebit = 0, totalCredit = 0, totalInterest = 0;

        transactions.forEach(txn => {
            const isEditing = txn.id === editingRowId;
            const newRow = tableBody.insertRow();
            newRow.className = isEditing ? 'edit-mode' : '';

            const fromDate = new Date(txn.fromDateStr);
            const toDate = new Date(txn.toDateStr);
            
            let days;
            if (txn.type === 'credit') {
                days = Math.ceil((toDate - fromDate) / (1000 * 3600 * 24));
            } else {
                days = Math.ceil((toDate - fromDate) / (1000 * 3600 * 24)) + 1;
            }

            let interest = txn.amount * days * (txn.dailyRate / 100);

            if (txn.type === 'credit') {
                interest *= -1;
                totalCredit += txn.amount;
            } else {
                totalDebit += txn.amount;
            }
            totalInterest += interest;

            if (isEditing) {
                newRow.innerHTML = `
                    <td class="text-left"><input type="date" id="edit-from-${txn.id}" value="${txn.fromDateStr}"></td>
                    <td class="text-left"><input type="date" id="edit-to-${txn.id}" value="${txn.toDateStr}"></td>
                    <td>
                        <div class="combined-field">
                            <select id="edit-type-${txn.id}">
                                <option value="debit" ${txn.type === 'debit' ? 'selected' : ''}>Debit</option>
                                <option value="credit" ${txn.type === 'credit' ? 'selected' : ''}>Credit</option>
                            </select>
                            <input type="number" step="0.01" id="edit-amount-${txn.id}" value="${txn.amount}">
                        </div>
                    </td>
                    <td></td>
                    <td>${days}</td>
                    <td><input type="number" step="0.001" id="edit-rate-${txn.id}" value="${txn.dailyRate}"></td>
                    <td>${interest.toFixed(2)}</td>
                    <td style="text-align: center; white-space: nowrap;">
                        <button class="action-btn save-btn" onclick="saveRow(${txn.id})">‚úì</button>
                        <button class="action-btn cancel-btn" onclick="cancelEdit()">‚úó</button>
                        <button class="action-btn delete-btn" onclick="deleteRow(${txn.id})">üóë</button>
                    </td>
                `;
                const amountCell = newRow.cells[2];
                const creditCell = newRow.cells[3];
                amountCell.colSpan = 2; 
                creditCell.style.display = 'none';

            } else {
                newRow.setAttribute('onclick', `editRow(${txn.id})`);
                newRow.innerHTML = `
                    <td class="text-left">${txn.fromDateStr}</td>
                    <td class="text-left">${txn.toDateStr}</td>
                    <td>${txn.type === 'debit' ? txn.amount.toFixed(2) : '0.00'}</td>
                    <td>${txn.type === 'credit' ? txn.amount.toFixed(2) : '0.00'}</td>
                    <td>${days}</td>
                    <td>${txn.dailyRate.toFixed(3)}%</td>
                    <td>${interest.toFixed(2)}</td>
                    <td style="text-align: center;">
                        <button class="action-btn" onclick="event.stopPropagation(); editRow(${txn.id})" title="Edit">‚úèÔ∏è</button>
                    </td>
                `;
            }
        });

        const grandBalance = totalDebit + totalInterest - totalCredit;

        document.getElementById('total-debit').innerText = totalDebit.toFixed(2);
        document.getElementById('total-credit').innerText = totalCredit.toFixed(2);
        document.getElementById('total-interest').innerText = totalInterest.toFixed(2);
        document.getElementById('grand-balance').innerText = grandBalance.toFixed(2);

        reportTotals = { totalDebit, totalCredit, totalInterest, grandBalance };
    }

    function editRow(id) {
        editingRowId = id;
        renderTable();
    }

    function cancelEdit() {
        editingRowId = null;
        renderTable();
    }
    
    function saveRow(id) {
        try {
            const index = transactions.findIndex(txn => txn.id === id);
            if (index === -1) return;

            const fromDateStr = document.getElementById(`edit-from-${id}`).value;
            const toDateStr = document.getElementById(`edit-to-${id}`).value;
            const amount = parseFloat(document.getElementById(`edit-amount-${id}`).value);
            const type = document.getElementById(`edit-type-${id}`).value;
            const dailyRate = parseFloat(document.getElementById(`edit-rate-${id}`).value);

            validateInputs(amount, fromDateStr, toDateStr, dailyRate);
            
            transactions[index] = { ...transactions[index], amount, fromDateStr, toDateStr, type, dailyRate };
            editingRowId = null;
            renderAndSave();
            showStatusMessage("‚úÖ Entry updated successfully!");
        } catch (error) {
            showStatusMessage(error.message, true);
        }
    }

    function deleteRow(id) {
        if (confirm("üóëÔ∏è Are you sure you want to delete this entry?")) {
            transactions = transactions.filter(txn => txn.id !== id);
            editingRowId = null;
            renderAndSave();
            showStatusMessage("‚úÖ Entry deleted successfully!");
        }
    }

    // AppGeyser-optimized file handling functions
    function exportData() {
        if (transactions.length === 0) {
            showStatusMessage("No data to export.", true);
            return;
        }
        
        setLoading(true);
        
        try {
            const fileName = `interest-data-${new Date().toISOString().slice(0, 10)}.json`;
            const dataStr = JSON.stringify(transactions, null, 2);

            // Check if Android interface exists (AppGeyser)
            if (typeof Android !== "undefined" && Android.saveFile) {
                Android.saveFile(dataStr, fileName, "application/json");
                showStatusMessage("üì§ Data exported successfully!");
            } else {
                // Fallback for web browsers
                const dataBlob = new Blob([dataStr], { type: 'application/json' });
                const url = URL.createObjectURL(dataBlob);
                const link = document.createElement('a');
                link.href = url;
                link.download = fileName;
                link.style.display = 'none';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                URL.revokeObjectURL(url);
                showStatusMessage("üì§ Data exported to downloads!");
            }
        } catch (error) {
            showStatusMessage("Export failed: " + error.message, true);
        } finally {
            setLoading(false);
        }
    }

    function downloadPDF() {
        if (transactions.length === 0) {
            showStatusMessage("No data to export to PDF.", true);
            return;
        }

        setLoading(true);
        
        try {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            const fileName = `Interest-Statement-${new Date().toISOString().slice(0, 10)}.pdf`;

            // PDF Generation
            const head = [['From Date', 'To Date', 'Debit Amount', 'Credit Amount', 'Days', 'Rate %', 'Interest']];
            const body = transactions.map(txn => {
                const fromDate = new Date(txn.fromDateStr);
                const toDate = new Date(txn.toDateStr);
                let days = (txn.type === 'credit') ? 
                    Math.ceil((toDate - fromDate) / (1000 * 3600 * 24)) : 
                    Math.ceil((toDate - fromDate) / (1000 * 3600 * 24)) + 1;
                let interest = txn.amount * days * (txn.dailyRate / 100);
                if (txn.type === 'credit') { interest *= -1; }
                return [
                    txn.fromDateStr, 
                    txn.toDateStr,
                    txn.type === 'debit' ? txn.amount.toFixed(2) : '0.00',
                    txn.type === 'credit' ? txn.amount.toFixed(2) : '0.00',
                    days,
                    txn.dailyRate.toFixed(3) + '%',
                    interest.toFixed(2)
                ];
            });

            const { totalDebit, totalCredit, totalInterest, grandBalance } = reportTotals;
            const foot = [
                [
                    { content: 'Totals', colSpan: 2, styles: { textAlign: 'left', fontStyle: 'bold'} }, 
                    { content: totalDebit.toFixed(2), styles: { fontStyle: 'bold' } }, 
                    { content: totalCredit.toFixed(2), styles: { fontStyle: 'bold' } }, 
                    { content: '', styles: { fontStyle: 'bold' } },
                    { content: 'Net Interest:', styles: { halign: 'right', fontStyle: 'bold' } }, 
                    { content: totalInterest.toFixed(2), styles: { fontStyle: 'bold' } }
                ],
                [
                    { content: 'Grand Balance', colSpan: 6, styles: { textAlign: 'right', fontStyle: 'bold'} }, 
                    { content: grandBalance.toFixed(2), styles: { fontStyle: 'bold' } }
                ]
            ];

            // PDF Header
            doc.setFontSize(18);
            doc.text("üìä Interest Calculation Statement", 14, 22);
            doc.setFontSize(11);
            doc.setTextColor(100);
            doc.text("Generated on: " + new Date().toLocaleDateString(), 14, 29);

            // PDF Table
            doc.autoTable({ 
                startY: 35, 
                head: head, 
                body: body, 
                foot: foot, 
                showFoot: 'lastPage', 
                theme: 'striped', 
                headStyles: { fillColor: [44, 62, 80] }, 
                footStyles: { fillColor: [236, 240, 241], textColor: [44, 62, 80], fontStyle: 'bold' }, 
                styles: { fontSize: 8 },
                didDrawPage: function (data) { 
                    let str = 'Page ' + doc.internal.getNumberOfPages(); 
                    doc.setFontSize(10); 
                    doc.text(str, data.settings.margin.left, doc.internal.pageSize.height - 10); 
                } 
            });

            // AppGeyser-compatible save
            if (typeof Android !== "undefined" && Android.saveFile) {
                const base64Data = doc.output('datauristring').split(',')[1];
                Android.saveFile(base64Data, fileName, "application/pdf");
                showStatusMessage("üìÑ PDF exported successfully!");
            } else {
                doc.save(fileName);
                showStatusMessage("üìÑ PDF downloaded to device!");
            }
        } catch (error) {
            showStatusMessage("PDF generation failed: " + error.message, true);
        } finally {
            setLoading(false);
        }
    }

    function importData(event) {
        const file = event.target.files[0];
        if (!file) return;

        if (transactions.length > 0 && !confirm("‚ö†Ô∏è This will overwrite your current data. Are you sure?")) {
            event.target.value = null; 
            return;
        }

        setLoading(true);

        const reader = new FileReader();
        reader.onload = function(e) {
            try {
                const importedData = JSON.parse(e.target.result);
                if (Array.isArray(importedData) && importedData.every(item => 
                    item.hasOwnProperty('id') && 
                    item.hasOwnProperty('amount') && 
                    item.hasOwnProperty('fromDateStr') && 
                    item.hasOwnProperty('toDateStr')
                )) {
                    transactions = importedData;
                    renderAndSave();
                    showStatusMessage("üì• Data imported successfully!");
                } else { 
                    throw new Error("Invalid data format."); 
                }
            } catch (error) {
                showStatusMessage("Import failed: " + error.message, true);
            } finally {
                event.target.value = null;
                setLoading(false);
            }
        };
        reader.readAsText(file);
    }

    function clearAllData() {
        if (transactions.length === 0) {
            showStatusMessage("No data to clear.", true);
            return;
        }
        if (confirm("üóëÔ∏è Are you sure you want to delete ALL data? This action cannot be undone.")) {
            transactions = [];
            renderAndSave();
            showStatusMessage("‚úÖ All data cleared successfully!");
        }
    }
    
    function clearInputs() {
        document.getElementById('amount').value = '';
        document.getElementById('from-date').value = '';
        if (!document.getElementById('default-to-date').checked) {
            document.getElementById('to-date').value = '';
        }
        // Focus back to amount field for quick entry
        document.getElementById('amount').focus();
    }

    // Enhanced mobile interactions
    function handleTouchStart(e) {
        // Add touch feedback for better mobile experience
        e.target.style.transform = 'scale(0.98)';
    }

    function handleTouchEnd(e) {
        setTimeout(() => {
            e.target.style.transform = '';
        }, 150);
    }

    // Initialize app
    window.addEventListener('load', function() {
        // Set default to-date if not set
        if (!document.getElementById('to-date').value) {
            document.getElementById('to-date').valueAsDate = new Date();
        }
        
        // Load and render existing data
        renderAndSave();
        
        // Add touch event listeners for better mobile experience
        document.querySelectorAll('button, .button-label').forEach(btn => {
            btn.addEventListener('touchstart', handleTouchStart, { passive: true });
            btn.addEventListener('touchend', handleTouchEnd, { passive: true });
        });
        
        // Prevent zoom on input focus (iOS Safari)
        document.querySelectorAll('input, select').forEach(input => {
            input.addEventListener('focus', function() {
                this.style.fontSize = '16px';
            });
        });
        
        // Show welcome message
        setTimeout(() => {
            showStatusMessage("üí´ Welcome! Ready to calculate interest.");
        }, 500);
    });

    // Handle orientation changes
    window.addEventListener('orientationchange', function() {
        setTimeout(() => {
            window.scrollTo(0, 0);
        }, 500);
    });

    // Prevent accidental page refresh
    window.addEventListener('beforeunload', function(e) {
        if (transactions.length > 0) {
            e.preventDefault();
            e.returnValue = '';
        }
    });

    // Keyboard shortcuts for desktop/tablet users
    document.addEventListener('keydown', function(e) {
        if (e.ctrlKey || e.metaKey) {
            switch(e.key) {
                case 's':
                    e.preventDefault();
                    exportData();
                    break;
                case 'Enter':
                    e.preventDefault();
                    addEntry();
                    break;
            }
        }
        
        if (e.key === 'Escape' && editingRowId) {
            cancelEdit();
        }
    });

    // Auto-save feature (every 30 seconds)
    setInterval(() => {
        if (transactions.length > 0) {
            saveData();
        }
    }, 30000);
</script>

</body>
</html>